# Setup
pacman::p_load(
tidyverse, lubridate, here, igraph,
ggplot2, scales, patchwork, jtools
)
set.seed(123)
# N√∫mero de agentes (usuarios)
N_AGENTES <- 500
# Distribuci√≥n de ideolog√≠as
# left, radical_right, libertarian_right, neutral
DIST_IDEOLOGIA <- c(
"left" = 0.20,              # 20% izquierda
"radical_right" = 0.30,      # 30% derecha radical
"libertarian_right" = 0.25,  # 25% derecha libertaria
"neutral" = 0.25             # 25% neutral
)
# Probabilidades de interacci√≥n
PROB_REPLY_SAME_STANCE <- 0.40      # Probabilidad de responder a mismo bloque
PROB_REPLY_OPPOSITE_STANCE <- 0.15  # Probabilidad de responder a bloque opuesto
PROB_REPLY_NEUTRAL <- 0.30          # Probabilidad de responder a neutral
# Intensidad de polarizaci√≥n (0-1)
POLARIZACION_INTENSIDAD <- 0.65
# Probabilidad de ataque vs. apoyo
PROB_ATAQUE_OPUESTO <- 0.70         # Probabilidad de atacar a opuesto
PROB_ATAQUE_MISMO <- 0.10            # Probabilidad de atacar a mismo bloque
# Par√°metros temporales
DIAS_SIMULACION <- 90                # D√≠as a simular
POSTS_POR_DIA <- 50                  # Posts nuevos por d√≠a
REPLIES_POR_POST <- 3                # Promedio de respuestas por post
# Par√°metros de red
PROB_SEGUIR_MISMO_BLOQUE <- 0.60     # Probabilidad de seguir a mismo bloque
PROB_SEGUIR_OPUESTO <- 0.05          # Probabilidad de seguir a opuesto
# Funci√≥n para determinar si dos ideolog√≠as son opuestas
son_opuestas <- function(ideologia1, ideologia2) {
opuestos <- list(
"left" = c("radical_right", "libertarian_right"),
"radical_right" = c("left"),
"libertarian_right" = c("left"),
"neutral" = character(0)
)
ideologia2 %in% opuestos[[ideologia1]]
}
# Funci√≥n para determinar probabilidad de interacci√≥n
prob_interaccion <- function(ideologia1, ideologia2) {
if (ideologia1 == ideologia2) {
return(PROB_REPLY_SAME_STANCE)
} else if (ideologia2 == "neutral") {
return(PROB_REPLY_NEUTRAL)
} else if (son_opuestas(ideologia1, ideologia2)) {
return(PROB_REPLY_OPPOSITE_STANCE)
} else {
return(PROB_REPLY_NEUTRAL)
}
}
# Funci√≥n para determinar tipo de interacci√≥n (ataque/apoyo)
tipo_interaccion <- function(ideologia1, ideologia2) {
if (ideologia1 == ideologia2) {
return(sample(c("apoyo", "ataque"), 1, prob = c(1 - PROB_ATAQUE_MISMO, PROB_ATAQUE_MISMO)))
} else if (son_opuestas(ideologia1, ideologia2)) {
return(sample(c("apoyo", "ataque"), 1, prob = c(1 - PROB_ATAQUE_OPUESTO, PROB_ATAQUE_OPUESTO)))
} else {
return(sample(c("apoyo", "ataque"), 1, prob = c(0.6, 0.4)))
}
}
cat("\nüîß Creando agentes...\n")
# Crear agentes con ideolog√≠as
agentes <- tibble(
id_agente = 1:N_AGENTES,
ideologia = sample(
names(DIST_IDEOLOGIA),
size = N_AGENTES,
replace = TRUE,
prob = DIST_IDEOLOGIA
),
actividad_base = rgamma(N_AGENTES, shape = 2, rate = 0.5), # Actividad variable
polarizacion = rbeta(N_AGENTES, shape1 = 2, shape2 = 2) * POLARIZACION_INTENSIDAD
) %>%
mutate(
# Normalizar actividad
actividad_base = (actividad_base - min(actividad_base)) /
(max(actividad_base) - min(actividad_base)),
# Score polarizante basado en ideolog√≠a y polarizaci√≥n
score_polarizante = case_when(
ideologia == "radical_right" ~ polarizacion * 0.9,
ideologia == "libertarian_right" ~ polarizacion * 0.7,
ideologia == "left" ~ polarizacion * 0.8,
TRUE ~ polarizacion * 0.3
)
)
cat(sprintf("   ‚úÖ %d agentes creados\n", nrow(agentes)))
cat(sprintf("   üìä Distribuci√≥n ideol√≥gica:\n"))
print(table(agentes$ideologia))
cat("\n‚è±Ô∏è  Simulando interacciones...\n")
# Inicializar estructuras de datos
posts <- tibble()
replies <- tibble()
red_interacciones <- tibble()
# Fecha inicial
fecha_inicio <- as.Date("2024-10-01")
fechas <- seq(fecha_inicio, fecha_inicio + DIAS_SIMULACION - 1, by = "day")
# Contador de posts
post_id_counter <- 1
reply_id_counter <- 1
for (dia in 1:length(fechas)) {
fecha_actual <- fechas[dia]
# Generar posts del d√≠a
n_posts_dia <- rpois(1, POSTS_POR_DIA)
if (n_posts_dia > 0) {
# Seleccionar autores de posts (basado en actividad)
autores_posts <- sample(
agentes$id_agente,
size = n_posts_dia,
replace = TRUE,
prob = agentes$actividad_base
)
# Crear posts
posts_dia <- tibble(
post_id = post_id_counter:(post_id_counter + n_posts_dia - 1),
autor_id = autores_posts,
fecha = fecha_actual,
ideologia_autor = agentes$ideologia[match(autores_posts, agentes$id_agente)],
score_polarizante = agentes$score_polarizante[match(autores_posts, agentes$id_agente)]
)
posts <- bind_rows(posts, posts_dia)
# Generar respuestas para cada post
for (post in 1:nrow(posts_dia)) {
post_actual <- posts_dia[post, ]
n_replies <- rpois(1, REPLIES_POR_POST)
if (n_replies > 0) {
# Seleccionar potenciales respondientes (basado en probabilidad de interacci√≥n)
prob_respuesta <- sapply(
agentes$ideologia,
function(ideologia) prob_interaccion(post_actual$ideologia_autor, ideologia)
)
# Ajustar por actividad
prob_respuesta <- prob_respuesta * agentes$actividad_base
prob_respuesta <- prob_respuesta / sum(prob_respuesta)
# Seleccionar respondientes
respondientes <- sample(
agentes$id_agente,
size = min(n_replies, N_AGENTES),
replace = FALSE,
prob = prob_respuesta
)
# Crear respuestas
replies_dia <- tibble(
reply_id = reply_id_counter:(reply_id_counter + length(respondientes) - 1),
post_id = post_actual$post_id,
autor_id = respondientes,
parent_autor_id = post_actual$autor_id,
fecha = fecha_actual + runif(length(respondientes), 0, 1), # Dentro del d√≠a
ideologia_autor = agentes$ideologia[match(respondientes, agentes$id_agente)],
ideologia_parent = post_actual$ideologia_autor,
tipo_interaccion = mapply(
tipo_interaccion,
agentes$ideologia[match(respondientes, agentes$id_agente)],
post_actual$ideologia_autor
),
score_polarizante = agentes$score_polarizante[match(respondientes, agentes$id_agente)]
)
replies <- bind_rows(replies, replies_dia)
# Agregar a red de interacciones
red_interacciones <- bind_rows(
red_interacciones,
tibble(
from = post_actual$autor_id,
to = respondientes,
fecha = fecha_actual,
tipo = "reply",
ideologia_from = post_actual$ideologia_autor,
ideologia_to = replies_dia$ideologia_autor
)
)
reply_id_counter <- reply_id_counter + length(respondientes)
}
}
post_id_counter <- post_id_counter + n_posts_dia
}
if (dia %% 10 == 0) {
cat(sprintf("   üìÖ D√≠a %d/%d completado\n", dia, length(fechas)))
}
}
cat(sprintf("\n   ‚úÖ Simulaci√≥n completada\n"))
cat(sprintf("   üìä Posts generados: %d\n", nrow(posts)))
cat(sprintf("   üí¨ Respuestas generadas: %d\n", nrow(replies)))
cat("\nüìä Generando an√°lisis...\n")
# Crear directorio de salida
OUT_DIR <- here("outputs", "Tesis", "abm")
if (!dir.exists(OUT_DIR)) dir.create(OUT_DIR, recursive = TRUE)
# Guardar datos simulados
write_csv(agentes, file.path(OUT_DIR, "agentes_simulados.csv"))
cat(sprintf("   ‚úÖ Datos guardados en %s\n", OUT_DIR))
# Tema para visualizaciones
theme_abm <- function() {
theme_apa(
legend.pos = "bottom",
remove.y.gridlines = TRUE,
remove.x.gridlines = TRUE
) +
theme(
plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
plot.subtitle = element_text(hjust = 0.5, color = "grey40")
)
}
# 1. Distribuci√≥n de ideolog√≠as
p1 <- agentes %>%
count(ideologia) %>%
mutate(ideologia = factor(ideologia,
levels = c("left", "radical_right", "libertarian_right", "neutral"))) %>%
ggplot(aes(x = ideologia, y = n, fill = ideologia)) +
geom_bar(stat = "identity") +
scale_fill_manual(values = c("left" = "#E74C3C",
"radical_right" = "#8B0000",
"libertarian_right" = "#FF6B6B",
"neutral" = "#95A5A6")) +
labs(title = "Distribuci√≥n de Ideolog√≠as en el ABM",
subtitle = "Agentes simulados",
x = "Ideolog√≠a", y = "N√∫mero de Agentes") +
theme_abm() +
theme(legend.position = "none")
p1
# 2. Evoluci√≥n temporal de posts
p2 <- posts %>%
mutate(fecha = as.Date(fecha)) %>%
count(fecha, ideologia_autor) %>%
ggplot(aes(x = fecha, y = n, color = ideologia_autor)) +
geom_line(size = 1) +
geom_point(size = 0.5) +
scale_color_manual(values = c("left" = "#E74C3C",
"radical_right" = "#8B0000",
"libertarian_right" = "#FF6B6B",
"neutral" = "#95A5A6")) +
labs(title = "Evoluci√≥n Temporal de Posts",
subtitle = "Por ideolog√≠a del autor",
x = "Fecha", y = "N√∫mero de Posts",
color = "Ideolog√≠a") +
theme_abm()
p2
# 3. Matriz de interacciones
p3 <- replies %>%
count(ideologia_autor, ideologia_parent) %>%
ggplot(aes(x = ideologia_parent, y = ideologia_autor, fill = n)) +
geom_tile() +
scale_fill_gradient(low = "white", high = "#E74C3C") +
labs(title = "Matriz de Interacciones",
subtitle = "Respuestas entre ideolog√≠as",
x = "Ideolog√≠a del Post Original",
y = "Ideolog√≠a del Respondiente",
fill = "N√∫mero de\nRespuestas") +
theme_abm() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p3
# 4. Distribuci√≥n de tipos de interacci√≥n
p4 <- replies %>%
count(ideologia_autor, ideologia_parent, tipo_interaccion) %>%
ggplot(aes(x = ideologia_parent, y = n, fill = tipo_interaccion)) +
geom_bar(stat = "identity", position = "dodge") +
facet_wrap(~ideologia_autor) +
scale_fill_manual(values = c("apoyo" = "#27AE60", "ataque" = "#E74C3C")) +
labs(title = "Tipos de Interacci√≥n por Ideolog√≠a",
subtitle = "Ataques vs. Apoyos",
x = "Ideolog√≠a del Post Original",
y = "N√∫mero de Respuestas",
fill = "Tipo") +
theme_abm() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
p4
# Guardar visualizaciones
ggsave(file.path(OUT_DIR, "01_distribucion_ideologias.png"), p1,
width = 10, height = 8, dpi = 300)
ggsave(file.path(OUT_DIR, "02_evolucion_temporal.png"), p2,
width = 12, height = 8, dpi = 300)
ggsave(file.path(OUT_DIR, "03_matriz_interacciones.png"), p3,
width = 10, height = 8, dpi = 300)
ggsave(file.path(OUT_DIR, "04_tipos_interaccion.png"), p4,
width = 14, height = 10, dpi = 300)
cat(sprintf("   ‚úÖ Visualizaciones guardadas\n"))
parametros <- tibble(
parametro = c(
"N_AGENTES",
"DIAS_SIMULACION",
"POSTS_POR_DIA",
"REPLIES_POR_POST",
"POLARIZACION_INTENSIDAD",
"PROB_REPLY_SAME_STANCE",
"PROB_REPLY_OPPOSITE_STANCE",
"PROB_ATAQUE_OPUESTO"
),
valor = c(
N_AGENTES,
DIAS_SIMULACION,
POSTS_POR_DIA,
REPLIES_POR_POST,
POLARIZACION_INTENSIDAD,
PROB_REPLY_SAME_STANCE,
PROB_REPLY_OPPOSITE_STANCE,
PROB_ATAQUE_OPUESTO
)
)
parametros
