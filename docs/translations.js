// Sistema de traducciones - OLES
const translations = {
    es: {
        // Navegaci√≥n
        nav: {
            inicio: "Inicio",
            acerca: "Acerca del Observatorio",
            mision: "Misi√≥n",
            equipo: "Equipo",
            investigacion: "Investigaci√≥n",
            estudios: "Estudios",
            todosEstudios: "üìã Todos los Estudios",
            encuestas: "üìä Encuestas",
            cualitativos: "üéôÔ∏è Cualitativos",
            prensaRedes: "üì∞ Prensa y Redes",
            datosAdmin: "üìà Datos Administrativos",
            proyectos: "Proyectos",
            publicaciones: "üìö Publicaciones Acad√©micas",
            tesis: "Tesis y Pr√°cticas",
            noticias: "Noticias",
            eventos: "Eventos",
            repositorio: "Repositorio",
            datos: "Datos",
            contacto: "Contacto",
            verTodas: "Ver todas ‚Üí",
            verMas: "Ver m√°s ‚Üí",
            verEstudios: "Todos los estudios ‚Üí"
        },
        // Secciones
        secciones: {
            destacados: "Destacados",
            noticiasRecientes: "Noticias Recientes",
            estudios: "Nuestras L√≠neas de Investigaci√≥n",
            proyectos: "Proyectos",
            todosProyectos: "Todos los proyectos",
            agenda: "Agenda",
            verMas: "Ver m√°s",
            acerca: "Acerca del Observatorio",
            mision: "Misi√≥n",
            vision: "Visi√≥n",
            equipo: "Equipo",
            direccion: "Direcci√≥n",
            subdireccion: "Subdirecci√≥n",
            verMasEquipo: "Ver m√°s del equipo ‚Üí"
        },
        // Equipo
        equipo: {
            directora: "Directora",
            director: "Director",
            subdirectora: "Subdirectora",
            subdirector: "Subdirector",
            direccion: "Direcci√≥n",
            subdirectores: "Subdirecci√≥n",
            investigadores: "Investigadores Asociados",
            coordinador: "Asistente Coordinador",
            asistentes: "Asistentes de Investigaci√≥n",
            verTesistas: "Tesistas y Pasantes",
            tesistasDescripcion: "Estudiantes que desarrollan sus tesis e investigaciones en el marco del Observatorio.",
            verTesistasBtn: "Ver Tesistas y Pasantes ‚Üí"
        },
        // Tipos
        tipos: {
            noticia: "Noticia",
            evento: "Evento",
            publicacion: "Publicaci√≥n"
        },
        // Contenido
        contenido: {
            mision: "El Observatorio de Legitimidad tiene como misi√≥n generar conocimiento cient√≠fico de calidad sobre la legitimidad institucional en Chile, contribuyendo al debate p√∫blico y a la formulaci√≥n de pol√≠ticas basadas en evidencia.",
            vision: "Ser un referente nacional e internacional en la investigaci√≥n sobre legitimidad institucional, desigualdades y cohesi√≥n social, promoviendo el di√°logo entre la academia, la sociedad civil y los tomadores de decisi√≥n.",
            verProyectos: "Ver proyectos",
            titulo: "Observatorio de Legitimidad"
        },
        // Estudios
        estudios: {
            titulo: "Nuestros Estudios de Investigaci√≥n",
            intro: "Listado completo de todas nuestras investigaciones activas y finalizadas.",
            encuestas: {
                titulo: "üìä Estudios de Encuesta",
                descripcion: "Investigaciones basadas en encuestas representativas que analizan percepciones y actitudes sobre legitimidad institucional."
            },
            cualitativos: {
                titulo: "üéôÔ∏è Estudios Cualitativos",
                descripcion: "Investigaciones cualitativas que profundizan en las experiencias y narrativas sobre legitimidad institucional."
            },
            prensa: {
                titulo: "üì∞ Estudios de Prensa y Redes Sociales",
                descripcion: "An√°lisis de contenido de medios de comunicaci√≥n y redes sociales sobre legitimidad y confianza institucional."
            },
            datos: {
                titulo: "üìà Estudios de Datos Administrativos",
                descripcion: "An√°lisis de datos administrativos y estad√≠sticos para comprender patrones de legitimidad institucional."
            }
        },
        // Acerca
        acerca: {
            descripcion: "El Observatorio de Legitimidad (OLES) es un centro de investigaci√≥n dedicado al estudio de la legitimidad institucional en Chile.",
            parrafo1: "Nuestro objetivo es generar conocimiento riguroso y de calidad sobre c√≥mo los ciudadanos perciben y eval√∫an las instituciones p√∫blicas.",
            parrafo2: "A trav√©s de nuestras l√≠neas de investigaci√≥n, buscamos contribuir al debate p√∫blico y a la formulaci√≥n de pol√≠ticas que fortalezcan la legitimidad democr√°tica."
        },
        // Footer
        footer: {
            enlaces: "Enlaces",
            contacto: "Contacto",
            investigacion: "Investigaci√≥n",
            derechos: "¬© 2025 Observatorio de Legitimidad. Todos los derechos reservados."
        }
    },
    en: {
        // Navigation
        nav: {
            inicio: "Home",
            acerca: "About the Observatory",
            mision: "Mission",
            equipo: "Team",
            investigacion: "Research",
            estudios: "Studies",
            todosEstudios: "üìã All Studies",
            encuestas: "üìä Surveys",
            cualitativos: "üéôÔ∏è Qualitative",
            prensaRedes: "üì∞ Press & Social Media",
            datosAdmin: "üìà Administrative Data",
            proyectos: "Projects",
            publicaciones: "üìö Academic Publications",
            tesis: "Thesis and Internships",
            noticias: "News",
            eventos: "Events",
            repositorio: "Repository",
            datos: "Data",
            contacto: "Contact",
            verTodas: "View all ‚Üí",
            verMas: "View more ‚Üí",
            verEstudios: "All studies ‚Üí"
        },
        // Sections
        secciones: {
            destacados: "Featured",
            noticiasRecientes: "Recent News",
            estudios: "Our Research Lines",
            proyectos: "Projects",
            todosProyectos: "All projects",
            agenda: "Agenda",
            verMas: "See more",
            acerca: "About the Observatory",
            mision: "Mission",
            vision: "Vision",
            equipo: "Team",
            direccion: "Direction",
            subdireccion: "Subdirection",
            verMasEquipo: "See more of the team ‚Üí"
        },
        // Team
        equipo: {
            directora: "Director",
            director: "Director",
            subdirectora: "Associate Director",
            subdirector: "Associate Director",
            direccion: "Direction",
            subdirectores: "Associate Directors",
            investigadores: "Associate Researchers",
            coordinador: "Coordinator Assistant",
            asistentes: "Research Assistants",
            verTesistas: "Thesis Students & Interns",
            tesistasDescripcion: "Students developing their theses and research within the Observatory.",
            verTesistasBtn: "View Thesis Students & Interns ‚Üí"
        },
        // Types
        tipos: {
            noticia: "News",
            evento: "Event",
            publicacion: "Publication"
        },
        // Content
        contenido: {
            mision: "The Legitimacy Observatory's mission is to generate high-quality scientific knowledge about institutional legitimacy in Chile, contributing to public debate and evidence-based policy formulation.",
            vision: "To be a national and international reference in research on institutional legitimacy, inequalities and social cohesion, promoting dialogue between academia, civil society and decision-makers.",
            verProyectos: "View projects",
            titulo: "Legitimacy Observatory"
        },
        // Studies
        estudios: {
            titulo: "Our Research Studies",
            intro: "Complete list of all our active and completed research.",
            encuestas: {
                titulo: "üìä Survey Studies",
                descripcion: "Research based on representative surveys that analyze perceptions and attitudes about institutional legitimacy."
            },
            cualitativos: {
                titulo: "üéôÔ∏è Qualitative Studies",
                descripcion: "Qualitative research that delves into experiences and narratives about institutional legitimacy."
            },
            prensa: {
                titulo: "üì∞ Press and Social Media Studies",
                descripcion: "Content analysis of media and social networks on institutional legitimacy and trust."
            },
            datos: {
                titulo: "üìà Administrative Data Studies",
                descripcion: "Analysis of administrative and statistical data to understand patterns of institutional legitimacy."
            }
        },
        // About
        acerca: {
            descripcion: "The Legitimacy Observatory (OLES) is a research center dedicated to the study of institutional legitimacy in Chile.",
            parrafo1: "Our goal is to generate rigorous and quality knowledge about how citizens perceive and evaluate public institutions.",
            parrafo2: "Through our research lines, we seek to contribute to public debate and the formulation of policies that strengthen democratic legitimacy."
        },
        // Footer
        footer: {
            enlaces: "Links",
            contacto: "Contact",
            investigacion: "Research",
            derechos: "¬© 2025 Legitimacy Observatory. All rights reserved."
        }
    }
};

// Mapeo de textos del navbar a claves de traducci√≥n
const navbarTranslations = {
    es: {
        'Inicio': 'Inicio',
        'Noticias': 'Noticias',
        'Investigaci√≥n': 'Investigaci√≥n',
        'üìã Todos los Estudios': 'üìã Todos los Estudios',
        'üìä Encuestas': 'üìä Encuestas',
        'üéôÔ∏è Cualitativos': 'üéôÔ∏è Cualitativos',
        'üì∞ Prensa y Redes': 'üì∞ Prensa y Redes',
        'üìà Datos Administrativos': 'üìà Datos Administrativos',
        'üìö Publicaciones Acad√©micas': 'üìö Publicaciones Acad√©micas',
        'Eventos': 'Eventos',
        'Equipo': 'Equipo',
        'Contacto': 'Contacto'
    },
    en: {
        'Inicio': 'Home',
        'Noticias': 'News',
        'Investigaci√≥n': 'Research',
        'üìã Todos los Estudios': 'üìã All Studies',
        'üìä Encuestas': 'üìä Surveys',
        'üéôÔ∏è Cualitativos': 'üéôÔ∏è Qualitative',
        'üì∞ Prensa y Redes': 'üì∞ Press & Social Media',
        'üìà Datos Administrativos': 'üìà Administrative Data',
        'üìö Publicaciones Acad√©micas': 'üìö Academic Publications',
        'Eventos': 'Events',
        'Equipo': 'Team',
        'Contacto': 'Contact'
    }
};

// Textos originales en espa√±ol para referencia inversa
const originalTexts = {
    'Home': 'Inicio',
    'News': 'Noticias',
    'Research': 'Investigaci√≥n',
    'üìã All Studies': 'üìã Todos los Estudios',
    'üìä Surveys': 'üìä Encuestas',
    'üéôÔ∏è Qualitative': 'üéôÔ∏è Cualitativos',
    'üì∞ Press & Social Media': 'üì∞ Prensa y Redes',
    'üìà Administrative Data': 'üìà Datos Administrativos',
    'üìö Academic Publications': 'üìö Publicaciones Acad√©micas',
    'Events': 'Eventos',
    'Team': 'Equipo',
    'Contact': 'Contacto'
};

// Funci√≥n para obtener traducci√≥n
function t(key, lang = 'es') {
    const keys = key.split('.');
    let value = translations[lang];
    for (const k of keys) {
        value = value?.[k];
    }
    return value || key;
}

// Funci√≥n para traducir el navbar
function translateNavbar(lang) {
    // Traducir links del navbar
    document.querySelectorAll('.navbar .nav-link .menu-text, .navbar .dropdown-text').forEach(element => {
        const currentText = element.textContent.trim();
        
        // Buscar en espa√±ol primero
        if (navbarTranslations.es[currentText]) {
            element.textContent = navbarTranslations[lang][currentText];
        }
        // Si est√° en ingl√©s, convertir a espa√±ol primero y luego traducir
        else if (originalTexts[currentText]) {
            const spanishText = originalTexts[currentText];
            element.textContent = navbarTranslations[lang][spanishText];
        }
    });
}

// Funci√≥n para cambiar idioma
function changeLanguage(lang) {
    // Guardar preferencia
    localStorage.setItem('language', lang);
    
    // Actualizar atributo lang del HTML
    document.documentElement.lang = lang;
    
    // Actualizar botones de idioma
    document.querySelectorAll('.language-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        }
    });
    
    // Traducir navbar
    translateNavbar(lang);
    
    // Traducir todos los elementos con data-i18n
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        const translation = t(key, lang);
        
        if (element.tagName === 'TITLE') {
            document.title = translation;
        } else if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            element.placeholder = translation;
        } else if (element.hasAttribute('data-i18n-html')) {
            element.innerHTML = translation;
        } else {
            element.textContent = translation;
        }
    });
}

// Inicializar idioma al cargar la p√°gina
document.addEventListener('DOMContentLoaded', () => {
    // Por defecto siempre espa√±ol, solo cambia si el usuario lo elige
    const savedLang = localStorage.getItem('language') || 'es';
    changeLanguage(savedLang);
    
    // Agregar event listeners a los botones de idioma
    document.querySelectorAll('.language-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');
            changeLanguage(lang);
        });
    });
});

// Asegurar que por defecto sea espa√±ol en primera visita
if (!localStorage.getItem('language')) {
    localStorage.setItem('language', 'es');
}
